# Udemy IT基礎知識とAWSの基礎力を習得する講座

- [講座URL](https://www.udemy.com/course/awsit-nb/learn/lecture/20315147#overview)
- 上記講座の学習記録を残す

## セッション2: サーバーを理解する

- サーバーとは何か
- 公開鍵認証方式とは何か
- EC2でサーバーを立てる(ハンズオン)

### EC2を起動してSSHに接続する

- 概要

    ``` plantuml
    @startuml
    class EC2{
        Public IP Address
    }

    Client -> EC2: ssh
    note top on link
    PrivateKeyを使ってアクセスする
    end note

    Client -> EC2: ブラウザでアクセス
    Client <- Apacheサーバー: ブラウザに応答する
    PublicKey --> EC2
    PrivateKey --> Client
    KeyPair <|-- PublicKey
    KeyPair <|-- PrivateKey
    EC2 o-- Apacheサーバー
    @enduml
    ```

- 作業手順
    1. EC2の作成
        - キーペアを作成する
            - `*.pem` ファイルをダウンロードする
    2. SSHで接続する
        - `pemファイル` を `.sshフォルダ` に移動
        `mv ~/Downloads/udemy-basic-keypair.pem ~/.ssh`
        - キーペアの権限を変更
        `❯ chmod 400 ~/.ssh/udemy-basic-keypair.pem`
        - SSH接続アクセス
        `❯ ssh -i ~/.ssh/udemy-basic-keypair.pem ec2-user@54.250.60.125`

    3. WEBサーバーの構築
        - Apacheサーバーをインストールする

            ``` bash
            # スーパーユーザーになる
            [ec2-user@ip-172-31-39-174 ~]$ sudo su
            # パッケージのアップデート
            [root@ip-172-31-39-174 ec2-user]# yum update -y
            # Apacheのインストール: httpd パッケージ
            [root@ip-172-31-39-174 ec2-user]# yum install httpd -y
            ```

        - Workspaceに移動する

            ``` bash
            [root@ip-172-31-39-174 ec2-user]# cd /var/www/html
            [root@ip-172-31-39-174 html]# ls
            ```

        - index.htmlを作成する

            ``` bash
            [root@ip-172-31-39-174 html]# ls
            [root@ip-172-31-39-174 html]# vim index.html
            [root@ip-172-31-39-174 html]# ls
            index.html
            [root@ip-172-31-39-174 html]# cat index.html
            <html><h1>hello world!!</h1></html>
            ```

        - サーバーの起動

            ``` bash
            [root@ip-172-31-39-174 html]# systemctl start httpd
            # EC2インスタンスが起動するとApacheサーバーを起動するように設定
            [root@ip-172-31-39-174 html]# systemctl enable httpd
            ```

## セッション3: ネットワークを理解する

- ネットワークの基礎
    - DNSサーバー
    - NAT
    - IPマスカレード
    - ISP
    - DHCPサーバー
    - IPアドレス
    - MACアドレス
- サブネット、サブネットマスク
    - サブネットマスクの使い方。運用方法。

### ネットワークの基礎

- `リクエスト` を送るには `住所(URL) -> IPアドレス` が必要
- `レスポンス` を送るためにも `住所(URL) -> IPアドレス` が必要
- `パケット` 送信するデータの単位
- `プロトコル` 通信方式のルール -> `HTTPプロトコル`
    - `HTTPプロトコル`: Webサーバとクライアントの間の通信プロトコル
        - 送信者 / 送信先のアドレス
        - データの送信順序
        - メッセージID
    - `HTTPSプロトコル`: HTTPをよりセキュアにしたプロトコル(推奨)
    - `FTPプロトコル`: ファイル転送を行うための通信プロトコル
- `DNSサーバー(Domain Name System)` IPアドレスとURLの対応関係を管理する
    - URL -> IPアドレスの変換をしてくれる  
    DNSサーバーと接続できないと `URL` でアクセスすることができない。

        ``` plantuml
        @startuml
        Client -> DNSサーバー: URL
        DNSサーバー -> DNSサーバー: Convert URL into IPアドレス 
        DNSサーバー -> Service: IPアドレス
        @enduml
        ```

    - DNSサーバーの階層構造

        ``` plantuml
        @startmindmap
        + root
        ++ jp
        +++ co
        ++++ yahoo
        +++++ mail
        +++++ www
        ++++ google
        +++++ maps
        +++ ne
        ++ com
        +++ facebook
        @endmindmap
        ```

- `ドメイン` の構成
    - <https://www.mercari.co.jp/blog/index>
        - トップレベルドメイン: jp
        - セカンドレベルドメイン: co
        - サードレベルドメイン: mercari
        - ホスト名: www
        - プロトコル: https
        - スキーム: https://
        - ディレクトリ: blob
        - ファイル名: index

- `ISP業者(インターネットサービスプロバイダ)` インターネットの接続を提供する
    - `ドメイン登録` をしてくれる
    - `DNSサーバ` を運用してくれる

- `Webブラウザの通信` の仕組み
    - `URI`: Uniform Resource Identifier URLとURNの総称
    - `HTML`: Webブラウザの画面表示に使う言語

- `インターネット` と `イーサネット`
    - `インターネット` 世界中に接続されたネットワークを指す言葉
    - `イーサネット` インターネットを構成するネットワークの接続方式
        - `LAN(Local Area Network)` ケーブルを使って接続する

- `中継機器` ネットワークの中継
    - `ISP` が世界規模の接続ができるようにDNSサーバーを使って宛先を決めている。
    - `モデム` 家庭内のネットワークの中継をしている。Private Network内の宛先を決めている。

- `デフォルトゲートウェイ` 最初に送信される場所。外部との接触点。
    - `ルーティングテーブル` で接続先を決めている

- `MACアドレス` の使い道
    - ネットワーク接続機器に製造時に設定されるアドレス。
    - 変更できない。(仮想のMACアドレスを付与した場合は変更できる)
    - 物理アドレスと言われる
    - イーサネット上の機器を区別するために使う。
    - 近いネットワークの機器と通信する際に利用する
    - バケツリレーのように通信する
    - `IPアドレス` はネットワーク上で追加で設定されるアドレス。
        - 変更可能。(意図的に固定しないと変更される)
        - 論理アドレス
        - 遠くのネットワークに接続するために使う
    - 通信イメージ

    ``` plantuml
    @startuml
    class MacAddress1{}
    MacAddress1 -> MacAddress2
    MacAddress2 -> MacAddress3
    MacAddress3 -> MacAddress4

    MacAddress1 -- IPAddress1
    MacAddress1 -- IPAddress2
    MacAddress4 --- IPAddress3
    IPAddress1 --> IPAddress3

    note top of MacAddress1
    Macアドレスでの通信はバケツリー
    MacAddress1からMacAddress4にアクセスする場合は
    途中の機器を経由する必要がある
    endnote

    note bottom of IPAddress1
    IPアドレスは遠くの機器と直接通信するイメージ
    IPAddress1からIPAddress3にアクセスする場合は
    途中の機器を経由する必要がない(実際はMACアドレスを使ってアクセスする)
    endnote
    @enduml
    ```

    - 実際の通信のイメージ

    ``` plantuml
    @startuml
    Client -> モデム: MACアドレス
    モデム -> DNSサーバー: MACアドレス
    DNSサーバー -> 中継機: MACアドレス
    中継機 -> 目的のサーバー: MACアドレス
    Client --> 目的のサーバー: IPアドレス
    note right
    Clientから目的のサーバに
    IPアドレスを使ってアクセスする場合も
    MACアドレスで機器を経由してアクセスする
    end note
    @enduml
    ```

- `グローバルIPアドレス`
    - IPv4形式の `134.128.24.16` の形式のIPアドレス
        - 枯渇している。足りていない
    - IPv6形式の `2001:268:c05f:c203:e0f5:fd5c:9c4f:d7d` の形式のIPアドレス
        - 徐々にこちらに移行している
    - インターネット上でのやり取りに利用するIPアドレス

- `プライベートIPアドレス`
    - 限られたエリアで利用する `IPアドレス`
    - IPアドレスは自由に付与することができる
    - `グローバルIPアドレス` への変換は `NAT` で行われる
        - `IPマスカレード` 複数のプライベートIPアドレスを一つの `グローバルIPアドレス` に変換する

    ``` plantuml
    @startuml
    class ルータ {
        IPマスカレード()
        NAT()
        DHCP()
    }

    グローバルIPアドレス <-- ルータ
    ルータ --> プライベートIPアドレス
    @enduml
    ```

- `DHCPサーバー` を使って `プライベートIPアドレス` が付与される

- プライベートネットワークの構成
    - ネットワークの範囲を決めるのは `IPアドレス` + `サブネットマスク`
        - `10.0.1.0/16` の `/16` の部分
    - `サブネットマスク` の使い方
        - `CIDR(Classless Inter-Domain Routing)(サイダー)` で範囲を指定する
        - 数字が使えるネットワークの範囲を決める
            - 8 : 左から8桁目までをロックする。10進の1セット  
            **xx**.xx.xx.xx
            - 16: 左から16桁目までをロックする。10進の2セット分
            **xx**.**xx**.xx.xx
            - 24: 左から24桁目までをロックする。10進の3セット分
            **xx**.**xx**.**xx**.xx
            - 32: 左から16桁目までをロックする。10進の4セット分。一意のIPアドレスのみ認める。
            **xx**.**xx**.**xx**.**xx**
        - 一覧表

            |サブネットマスク|IPアドレス数|
            |---|---|
            |/18|16384|
            |/20|4096|
            |/22|1024|
            |/24|256|
            |/26|64|
            |/28|16|
        - ローカルなネットワークのグループ分に使うことができる

    ``` plantuml
    @startuml
    package AZ <<Rectangle>> {
        package VPC <<Rectangle>> {
            class IPアドレス {
                10.0.1.0/16
            }
            note bottom: 10.0.xx.xxの範囲を使える
            package パブリックネットワーク <<Rectangle>> {
            class IPアドレス {
                10.0.1.0/24
            }
            note bottom: 10.0.1.xxの範囲を使える
                class publicEC2
            }
            package プライベートネットワーク <<Rectangle>> {
            class IPアドレス {
                10.0.2.0/24
            }
            note bottom: 10.0.2.xxの範囲を使える
                class privateEC2
            }
        }
    }
    @enduml
    ```

- メールの通信のルール
    - `SMTPサーバー` 送信用のサーバ
        - `SMTPプロトコル(Simple Mail Transfer Protocol)` メール送信用のプロトコル
    - `POP/IMAPサーバー` 受信用のサーバ
        - `POP(Post Office Protocol)` メール受信用のプロトコル

- `OSI参照モデル` 通信ルールの規約
    1. アプリケーション層:
        - Chromeなど  
        - `POP/SMTP` プロトコルが関わってくる
        - `HTTP/HTTPS` プロトコルが関わってくる
    2. プレゼンテーション層:
        - 文字コード・圧縮・暗号/復号方法など
        - `SSL` 暗号通信プロトコル
    3. セッション層:
        - アプリケーションのセッション(連続した処理)に関わる処理
    4. トランスポート層:
        - ノード間のデータ転送における `コネクション`。
        - ポート番号の割り当ての規定  
        - `TCP` 通信プロトコル
        - `コネクション`: 論理的な回線を接続する。
        - `セッション`: 通信の開始から終了まで
    5. ネットワーク層:
        - `IP` アドレスを利用した割り当てなどを行う
        - ルーティングもここで行なっている
    6. データリンク層:
        - MACアドレスによるノード間の通信の規定
        - ネットワーク回線上で直接接続されたノード間の通信の規定
    7. 物理層:
        - ビット(`0`,`1`)を使った実際のコンピュータが送受信する伝送方式のプロトコルを規定

- ポート番号
    - 通信の出入り口になるのがポート
    - `エンドポイント` である
    - `コンピュータ` のソフトウェアごとにポート番号が設定される

- `VPC(Virtual Private Cloud)` 仮想のネットワーク環境

### ハンズオン: AWSネットワークを作る

Route 53についてはDomainの取得ができなかったので未対応

1. VPCを作成する
    - CIDR: 10.0.0.0/16
2. インターネットゲートウェイを作る
    - ルータの役割を持っていてVPCとインターネットを接続する役割を持つ
3. インターネットゲートウェイをVPCにアタッチする
4. サブネットを作る
    - blue, red, greenの3つのサブネットを作成
5. サブネットのルートテーブルを設定する
    - サブネットを外部と接続するため
    - ルートテーブルを編集する
    - `0.0.0.0/0` への通信を2.で作ったインターネットゲートウェイを通して実行できるようにした
6. セキュリティグループの設定
    - HTTP, HTTPS, SMTPを許可する
    - EC2にアクセスすることはできなかった。。。
        - HTTPプロトコルではアクセスできた
        - HTTPSプロトコルではできなかった

## セッション4: データベースを理解する

### データベースとは

- データベースはテーブル形式でデータを格納している
- データベースはデータ操作の課題に対応するために存在する
    - クラッシュしてもデータが消えないか？
    - 誤って削除した場合に対処できないか？
    - データ抽出に誤りがないか？
    - 2人が同時に同じデータにアクセスした際にどうするか？
    - 大量のデータをうまく検索できないか？
- データベースの主な操作(クエリ): CRUD
    - 追加 Create
    - 参照 Read
    - 更新 Update
    - 削除 Delete
- データベースの仕組み
    - トランザクション: 処理・操作の一つの塊
        - ACID特性: トランザクションが持つべき性質
            - Atomicity: 全て実行されるか、一つも実行されないのどちらかになる  
            中途半端な操作は行わない
            - Consistency: データの整合性を保つ。矛盾が生まれないようにする。
                - 結果整合性: 更新中も古いデータを参照**できる**
                - 強い整合性: 更新中はデータを参照**できない**
            - Isolation: 処理過程が外部から隠蔽され、他の処理などに影響を与えない
            - Durability: トランザクションの結果は記録されてクラッシュしても失われない
        - トランザクションの後に実施される処理(全て実行するか、一つも実行しないを決める)
            - Commit: トランザクションの処理結果を反映する操作
            - ロールバック: 処理を巻き戻す。トランザクションを操作しなかったことにする
    - データモデル: DBMS上で利用するモデル
        - データモデルによってトランザクション機能が変わる
        - データモデルの種類
            - リレーショナルモデル
            - グラフモデル
            - キーバリューストア
            - オブジェクト
            - ドキュメント
            - ワイドカラム
            - 階層型

- リレーショナルモデル
    - 複数のテーブルをキーを使って紐づけて扱うモデル
    - リレーショナルモデルのデータベースをリレーショナルデータベース(RDB)という
    - 行と列を使って指定する
        - 行指向データベースとも言われる
- データベースエンジン
    - ディスクを操作するソフトウェア
    - 種類
        - Oracle Database
        - SQL Server
        - DB2
        - MySQL
        - MariaDB
        - PostgreSQL

### MySQL

- SQL(Structured Query Language)はリレーショナルデータベースを操作するための言語
- SQLの操作順
    - データベースの作成
    - テーブルの作成
    - データの挿入

    ```plantuml
    @startuml
    package データベース <<Database>> {
        package Artデータベース <<Rectangle>> {
            package usersテーブル <<Rectangle>> {
                class data {
                    ID
                    name
                    age
                }
            }
        }
    }
    @enduml
    ```

- SQLのメリット
    - 見たい範囲を決められる
    - 見え方を決めることができる
    - 必要なデータを抽出して分析できる
    - 機械学習用のデータの抽出可能
- SQLのタイプ
    - データ定義言語: DDL データベースを操作する
        - CREATE: 作成
        - ALTER: 構造の変更
        - DROP: 削除
        - RENAME: 名前の変更
    - データ操作言語: DML データベースを操作する
        - SELECT: 行の取得
        - INSERT: 行の挿入
        - UPDATE: 行の項目の値を更新
        - DELETE: テーブルから行を削除
        - MERGE: 行の挿入と更新を同時に行う
    - データ制御言語: DCL データへのアクセス制御(トランザクション、システム管理)
        - BEGIN: トランザクションの開始
        - END: トランザクションの終了
        - COMMIT: トランザクションの確定
        - ROLLBACK: トランザクションのクエリを取りやめる
        - GRANT: 列の権限の設定
        - REVOKE: 列の権限の取り消し

- AWS RDB
    - AWSのサービスとして提供されているDB
        - EC2にDBをインストールする方法もある
    - 制約事項(運用を任せているトレードオフ)
        - バージョンが限定される。最新バージョンが使えるとは限らない
        - キャパシティに上限がある
        - OSへのログインができない。操作に制限がある。
        - ファイルシステムへのアクセスができない。操作に制限がある。
        - IPアドレスが固定できない
        - 一部の機能が使えない
        - 個別パッチは適用できない
    - メリット
        - フェールオーバに強い
            - 同期レプリケーションができる
            - リードレプリカを作ることができる
                - 読取用のデータベース
                - データの呼び出しの負荷をマスター側から解放できるのでパフォーマンスが維持しやすい
        - 複数のAZにデータベースを作ることで障害に強い
        - マスター/スレーブの関係を簡単に構築できる
        - スナップショット(バックアップ)やトランザクションのログを残すことができる(S3を活用する)
        - スケーリング
            - インスタンプタイプの変更は可能
            - ストレージサイズは拡張できるが縮小できない
            - データベースシャーディング
                - RDSの書き込み処理をスケーリングすることもできる
                - 複数のRDSを用意して格納するデータによってRDSを切り替える
        - 暗号化ができる
            - 暗号化の対象
                - DBインスタンス
                - 自動バックアップ
                - リードレプリカ
                - スナップショット

### データベースのハンズオン

1. RDSの作成
    - 標準作成
2. [VPCのセキュリティグループ](https://ap-northeast-1.console.aws.amazon.com/ec2/v2/home?region=ap-northeast-1#SecurityGroup:groupId=sg-01e6d05a8256d81dc)の編集
    - MYSQL/Auroraを許可する
3. MySQL Workbenchをインストールする
4. パブリックアクセシビリティの設定をする
5. MySQL Workbenchと接続する
    - host: DBのエンドポイントを設定する
6. DBを削除する

## セッション5: 仮想化とクラウドを理解する

### クラウドと仮想化

#### クラウド

- クラウドとは仮想化されたインフラである
    - 物理的なサーバーを仮想化で分割してユーザーに提供している

- クラウドの特徴
    - 5つの基本特性
        - オンデマンド・セルフサービス
        - 幅広いネットワークアクセス
        - リソースの共有
        - 迅速な拡張性
        - サービスは計測可能
    - 3つのサービス形態
        - SaaS: ソフトウェア。アプリケーションを借りる
        - PaaS: プラットフォーム。ミドルウェアなどを借りる
        - IaaS: インフラを借りる
    - 3つのサービス形態
        - オンプレミス: 自社所有。サーバーとして利用する。
        - プライベートクラウド: 自社所有。自社クラウド化する。
        - パブリッククラウド: 他社所有。外部クラウドを使う。

#### 仮想化

- 物理的なインフラの構成を論理的に分割したり、統合して使っているように使うことができる方法が仮想化
- 仮想化の仕組み
    - 分割された機能ブロック
    - 仮想化ソフトウェア
    - 物理的なサーバー
- 仮想化の対象
    - サーバー
        - ハイバーバイザー型
            - ゲストOSが必要になる
            - EC2インスタンスなど
        - ホスト型
        - コンテナ型
            - ゲストOSを使わない
            - DockerエンジンがゲストOSの代わりになる
            - コンテナは環境設定をコード化することができる
                - SDI(Software-Defined Infrastructure)
    - ストレージ
        - ブロックレベル仮想化
        - ファイルレベル仮想化
    - ネットワーク構成
        - SDN
        - VLAN
    - デスクトップ
        - 仮想PC方式
        - ブレードPC方式
- 仮想化のメリット
    - インフラ利用の効率性や柔軟性が向上する
    - サーバースペース、データセンターの削減
    - コスト削減
    - 調達の迅速化
    - 構成変更やメンテナンス対応の柔軟性
    - セキュリティの向上

### SDIのハンズオン

## セッション6: WEBを理解する

- MVCアーキテクチャ
    - Model: メインのアプリケーション処理
    - View: 画面表示に関する処理
    - Controller: ユーザーからの入力を受け付けてModel、Viewを制御する。

### 開発環境のハンズオン

1. Cloud9の作成
2. Hello Worldの作成
3. GitHub Accountの登録(すでに持っているアカウントを使う)
4. アクセストークンの発行
    - udemy-it-basic
    - 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
5. Hello WorldをPush
6. Hello WorldをPull
7. Rubyを書いてみる
